# ğŸ“– File Upload Feature - Visual Reference Guide

## ğŸ¨ UI Elements Added

### Project Form - New Section
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PROJECT INFO TAB                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  Title: [___________________]               â”‚
â”‚                                             â”‚
â”‚  Description: [RICH TEXT EDITOR]            â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Attachment                          â”‚   â”‚
â”‚  â”‚ [Choose File]  (PNG, JPG, PDF only) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚  âœ“ File selected: document.pdf              â”‚  â† Green box
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Existing Attachments:               â”‚   â”‚  â† Blue box
â”‚  â”‚ ğŸ“ budget.pdf    [Download]         â”‚   â”‚
â”‚  â”‚ ğŸ“ logo.jpg      [Download]         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ticket Form - New Section
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          TICKET INFO TAB                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Title: [_____________________]              â”‚
â”‚                                              â”‚
â”‚  Description: [RICH TEXT EDITOR]             â”‚
â”‚                                              â”‚
â”‚  Type: [SELECT]    Status: [SELECT]          â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Attachment                             â”‚  â”‚
â”‚  â”‚ [Choose File]  (PNG, JPG, PDF only)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚  âœ“ File selected: image.jpg                  â”‚  â† Green
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Existing Attachments:                  â”‚  â”‚  â† Blue
â”‚  â”‚ ğŸ“ screenshot.png  [Download]          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚  Created 2 hours ago                         â”‚
â”‚  Updated 1 hour ago                          â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ File Storage Structure

```
TrackIt-master/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ uploads/                    â† NEW FOLDER
â”‚   â”‚   â”œâ”€â”€ 1734011234567-doc.pdf   â† Uploaded files
â”‚   â”‚   â”œâ”€â”€ 1734011235890-img.jpg
â”‚   â”‚   â”œâ”€â”€ 1734011236123-photo.png
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ upload.js               â† UPDATED
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ project.model.js        â† UPDATED (attachments field)
â”‚   â”‚   â”œâ”€â”€ ticket.model.js         â† UPDATED (attachments field)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ project.controller.js   â† UPDATED (handle file)
â”‚   â”‚   â”œâ”€â”€ ticket.controller.js    â† UPDATED (handle file)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ project.route.js        â† UPDATED (upload middleware)
â”‚   â”‚   â”œâ”€â”€ ticket.route.js         â† UPDATED (upload middleware)
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ app.js                      â† UPDATED (static serve)
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ project-service.js  â† UPDATED (FormData)
â”‚   â”‚   â”‚   â”œâ”€â”€ ticket-service.js   â† UPDATED (FormData)
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â”œâ”€â”€ projects/
â”‚   â”‚       â”‚   â””â”€â”€ AddProject.jsx   â† UPDATED (file input)
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ tickets/
â”‚   â”‚       â”‚   â”œâ”€â”€ CreateTicket.jsx â† UPDATED (file state)
â”‚   â”‚       â”‚   â”œâ”€â”€ TicketInfo.jsx   â† UPDATED (file input + display)
â”‚   â”‚       â”‚   â””â”€â”€ ...
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ UPLOAD_FEATURE_SETUP.md         â† Documentation
â”œâ”€â”€ QUICK_START_UPLOAD.md           â† Quick start guide
â”œâ”€â”€ IMPLEMENTATION_CHECKLIST.md     â† Detailed checklist
â”œâ”€â”€ FEATURE_SUMMARY.md              â† Feature overview
â””â”€â”€ ...
```

---

## ğŸ”„ Request/Response Examples

### 1. Create Project with File

**Frontend (FormData):**
```js
const formData = new FormData();
formData.append("title", "My Project");
formData.append("description", "Project description");
formData.append("assignees[0]", "userId1");
formData.append("assignees[1]", "userId2");
formData.append("attachment", fileObject);

// POST to /project
axios.post("/project", formData, {
  headers: { "Content-Type": "multipart/form-data" }
});
```

**Backend Processing:**
```
1. Express receives multipart/form-data
2. Multer middleware:
   - Checks MIME type (PNG, JPG, JPEG, PDF only)
   - Saves file to /uploads/1734011234567-filename.pdf
   - Passes req.file to controller
3. Controller:
   - Creates project in MongoDB
   - Pushes attachment to attachments array
   - Returns created project with attachment info
```

**Database Result:**
```js
{
  _id: ObjectId("..."),
  title: "My Project",
  description: "Project description",
  assignees: [userId1, userId2],
  attachments: [{
    fileName: "1734011234567-document.pdf",
    filePath: "uploads/1734011234567-document.pdf",
    uploadedAt: ISODate("2025-12-11T10:30:00.000Z")
  }],
  createdOn: ISODate("2025-12-11T10:30:00.000Z"),
  updatedOn: ISODate("2025-12-11T10:30:00.000Z")
}
```

**Disk Result:**
```
server/uploads/
â””â”€â”€ 1734011234567-document.pdf  (actual file content)
```

**Response to Frontend:**
```js
{
  _id: "...",
  title: "My Project",
  attachments: [{
    fileName: "1734011234567-document.pdf",
    filePath: "uploads/1734011234567-document.pdf",
    uploadedAt: "2025-12-11T10:30:00.000Z"
  }]
}
```

---

### 2. Create Ticket with File

**Frontend (FormData):**
```js
const formData = new FormData();
formData.append("type", "bugTypeId");
formData.append("title", "Fix login button");
formData.append("description", "Login button not working");
formData.append("status", "Open");
formData.append("assignees[0]", "userId1");
formData.append("estimatedTime", 5);
formData.append("estimatedTimeUnit", "h");
formData.append("attachment", fileObject);

// POST to /ticket/project/:projectId
axios.post(`/ticket/project/${projectId}`, formData, {
  headers: { "Content-Type": "multipart/form-data" }
});
```

**Database Result:**
```js
{
  _id: ObjectId("..."),
  projectId: ObjectId("..."),
  title: "Fix login button",
  type: ObjectId("..."),
  description: "Login button not working",
  status: "Open",
  assignees: [userId1],
  estimatedTime: 5,
  estimatedTimeUnit: "h",
  attachments: [{
    fileName: "1734011235890-screenshot.jpg",
    filePath: "uploads/1734011235890-screenshot.jpg",
    uploadedAt: ISODate("2025-12-11T10:31:00.000Z")
  }],
  createdBy: ObjectId("..."),
  createdOn: ISODate("2025-12-11T10:31:00.000Z")
}
```

---

## ğŸ¯ File Download Flow

```
User clicks "Download" in UI
        â†“
onClick handler executes:
        â†“
Creates <a> element
        â†“
Sets href to: http://localhost:5000/uploads/1734011234567-file.pdf
        â†“
Sets download attribute to: "file.pdf"
        â†“
Simulates click
        â†“
Browser downloads file with original name
```

**Code:**
```js
const link = document.createElement("a");
link.href = `http://localhost:5000/${att.filePath}`;
link.download = att.fileName.split("-")[1]; // Get original name
link.click();
```

---

## ğŸ” Security Validation Flow

```
User selects file in browser
        â†“
Frontend Input: accept="image/png,image/jpeg,image/jpg,application/pdf"
        â†“
User submits form
        â†“
Service creates FormData with file
        â†“
Axios POSTs multipart/form-data
        â†“
Backend Route receives request
        â†“
Multer Middleware checks:
  1. File exists? â†’ YES
  2. MIME type in allowed list?
     ["image/png", "image/jpeg", "image/jpg", "application/pdf"]
     â†’ YES
  3. Unique filename: Date.now() + "-" + originalname
     â†’ "1734011234567-document.pdf"
  4. Save to: uploads/1734011234567-document.pdf
        â†“
Controller receives req.file
        â†“
Push to attachments array
        â†“
Save to database
        â†“
Return success response
```

---

## ğŸ“Š Component Props Flow

### CreateTicket â†’ TicketInfo
```js
<TicketInfo
  ticketInfo={ticketInfo}
  onHandleFormSubmit={onHandleFormSubmit}
  formRef={formRef}
  error={error}
  ticketDescription={ticketDescription}
  setTicketDescription={setTicketDescription}
  
  // NEW PROPS:
  attachmentFile={attachmentFile}        // File object
  setAttachmentFile={setAttachmentFile}  // State setter
  existingAttachments={ticket?.attachments || []}  // Array
/>
```

### AddProject â†’ Form
```js
// File state in AddProject.jsx
const [attachmentFile, setAttachmentFile] = useState(null);

// Passed to service
ProjectService.createProject(projectData, attachmentFile);
ProjectService.updateProject(projectData, projectId, attachmentFile);
```

---

## ğŸ§  State Management

### In CreateTicket.jsx
```js
const [attachmentFile, setAttachmentFile] = useState(null);

// Usage:
// 1. User selects file
<input onChange={(e) => setAttachmentFile(e.target.files[0])} />

// 2. Submit form with file
TicketService.createTicket(project._id, ticketData, attachmentFile);

// 3. Clear on close
setAttachmentFile(null);
```

### In TicketInfo.jsx
```js
// Receive from parent
const { attachmentFile, setAttachmentFile, existingAttachments } = props;

// File input
<Input
  type="file"
  onChange={(e) => setAttachmentFile(e.target.files[0])}
/>

// Display selected
{attachmentFile && (
  <Box p={2} bg="green.100">
    âœ“ File selected: {attachmentFile.name}
  </Box>
)}

// Display existing
{existingAttachments.length > 0 && (
  <Box p={3} bg="blue.50">
    {existingAttachments.map((att) => (
      <HStack>
        <Text>ğŸ“ {att.fileName}</Text>
        <Button onClick={() => downloadFile(att)}>Download</Button>
      </HStack>
    ))}
  </Box>
)}
```

---

## ğŸ”— API Endpoint Mapping

```
Frontend Call                          Backend Route
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /project                     POST   /project
  + FormData                         + upload.single("attachment")
  + file                             + addProject()

PATCH /project/:id                PATCH  /project/:id
  + FormData                         + upload.single("attachment")
  + file                             + updateProject()

POST /ticket/project/:projectId    POST   /ticket/project/:projectId
  + FormData                         + upload.single("attachment")
  + file                             + createTicket()

PATCH /ticket/project/:projectId   PATCH  /ticket/project/:projectId
  + FormData                         + upload.single("attachment")
  + file                             + updateTicket()
```

---

## ğŸ¨ Chakra UI Components Used

**New Imports Added:**
```js
import {
  Text,       // Display file name and info
  Box,        // Container for status messages
  VStack,     // Vertical layout for attachments list
  HStack,     // Horizontal layout for file + download button
  Button,     // Download button
} from "@chakra-ui/react";
```

**UI Pattern:**
```js
// File Input
<FormControl>
  <FormLabel>Attachment</FormLabel>
  <Input type="file" accept="..." />
  <Text fontSize="xs">Allowed: PNG, JPG, JPEG, PDF</Text>
</FormControl>

// Status Message (Green)
{file && (
  <Box p={2} bg="green.100" borderRadius="md">
    <Text fontSize="sm" color="green.800">
      âœ“ File selected: {file.name}
    </Text>
  </Box>
)}

// Attachments List (Blue)
{attachments.length > 0 && (
  <Box p={3} bg="blue.50" borderRadius="md">
    <Text fontSize="sm" fontWeight={600}>
      Existing Attachments:
    </Text>
    <VStack align="start" spacing={1}>
      {attachments.map((att) => (
        <HStack key={idx} spacing={2}>
          <Text fontSize="sm">ğŸ“ {att.fileName}</Text>
          <Button size="xs" colorScheme="blue">
            Download
          </Button>
        </HStack>
      ))}
    </VStack>
  </Box>
)}
```

---

## ğŸ“ Error Handling

**User Selects Non-Allowed File:**
```
User tries to upload .docx file
        â†“
Frontend input has accept="...pdf,image/..."
        â†“
Browser prevents selection (file dialog doesn't show .docx)
        â†“
OR user overrides and selects anyway
        â†“
Backend Multer fileFilter checks MIME type
        â†“
MIME type not in allowed array
        â†“
Multer rejects with error
        â†“
Error returned to frontend
        â†“
Alert shown to user: "File type not allowed"
```

---

## âœ… Validation Layers

```
Layer 1: Browser (accept attribute)
  â””â”€ User sees only allowed file types

Layer 2: Frontend Validation (optional)
  â””â”€ Could add file size check
  â””â”€ Could add file extension check

Layer 3: Multer File Filter
  â””â”€ Checks MIME type
  â””â”€ Returns error if not allowed

Layer 4: Controller
  â””â”€ Verifies req.file exists
  â””â”€ Saves to database
  â””â”€ Returns success/error
```

---

## ğŸ¯ Key Files Reference

| File | Purpose | Changes |
|------|---------|---------|
| `upload.js` | Multer config | File type validation |
| `project.model.js` | DB schema | + attachments field |
| `ticket.model.js` | DB schema | + attachments field |
| `project.controller.js` | Logic | Handle file on create/update |
| `ticket.controller.js` | Logic | Handle file on create/update |
| `project.route.js` | Routes | + upload middleware |
| `ticket.route.js` | Routes | + upload middleware |
| `app.js` | Express | + static file serving |
| `project-service.js` | API calls | Use FormData |
| `ticket-service.js` | API calls | Use FormData |
| `AddProject.jsx` | UI | + file input |
| `CreateTicket.jsx` | UI | + file state |
| `TicketInfo.jsx` | UI | + file input & display |

---

This visual reference should help you understand every aspect of the file upload feature! ğŸ¨

